class PeekoBot{constructor(a,b){this.chat=a,this.supportedLanguages=b?.supportedLanguages||Object.keys(this.chat),this.currentLanguage=b?.currentLanguage||"en",this.peekobot=document.getElementById("peekobot"),this.container=document.getElementById("peekobot-container"),this.inner=document.getElementById("peekobot-inner"),this.restartButton=null}sleep(a){return new Promise(b=>setTimeout(b,a))}scrollContainer(){this.inner.scrollTop=this.inner.scrollHeight}insertNewChatItem(a){this.peekobot.appendChild(a),this.scrollContainer(),a.classList.add("activated")}async printResponse(a){const b=document.createElement("div");if(b.classList.add("chat-response"),console.log(a),b.innerHTML=a.text,this.insertNewChatItem(b),await this.sleep(1500),a.options){const b=document.createElement("div");b.classList.add("choices"),a.options.forEach(function(a){const c=document.createElement(a.url?"a":"button");c.classList.add("choice"),c.innerHTML=a.text,a.url?c.href=a.url:c.dataset.next=a.next,b.appendChild(c)}),this.insertNewChatItem(b)}else a.next&&this.printResponse(this.chat[this.currentLanguage][a.next])}printChoice(a){const b=document.createElement("div");b.classList.add("chat-ask"),b.innerHTML=a.innerHTML,this.insertNewChatItem(b)}disableAllChoices(){const a=document.querySelectorAll(".choice");a.forEach(function(a){a.disabled="disabled"})}async handleChoice(a){if(!a.target.classList.contains("choice")||"A"===a.target.tagName){var b=a.target.closest("#peekobot-container .choice");return void(null!==b&&b.click())}a.preventDefault();const c=a.target;this.disableAllChoices(),this.printChoice(c),this.scrollContainer(),await this.sleep(1500),c.dataset.next&&this.printResponse(this.chat[this.currentLanguage][c.dataset.next])}handleRestart(){this.startConversation()}startConversation(){this.printResponse(this.chat[this.currentLanguage][1])}init(){var a=this;this.container.addEventListener("click",a.handleChoice.bind(a));var b=document.getElementById("peekobot-footer");if(this.restartButton=document.createElement("button"),this.restartButton.innerText="Restart",this.restartButton.classList.add("restart"),this.restartButton.addEventListener("click",a.handleRestart.bind(a)),this.restartButton.addEventListener("touch",a.handleRestart.bind(a)),window.getLanguageNativeName&&1!==this.supportedLanguages.length){var c=document.createElement("div");if(c.className="chat-languages",5>this.supportedLanguages.length)for(var d,e=0;e<this.supportedLanguages.length;e++){if(d=this.supportedLanguages[e],!this.chat[d])throw new Error(`${d} specified as supported language but can not be founded in chat object`);var f=document.createElement("button");f.className="language",f.textContent=getLanguageNativeName(d),f.addEventListener("click",a.changeChatLanguage.bind(this,d)),f.addEventListener("touch",a.changeChatLanguage.bind(this,d)),c.appendChild(f)}else{var g=document.createElement("select");g.addEventListener("change",function(){console.log(this.options[this.selectedIndex].value),a.changeChatLanguage(this.options[this.selectedIndex].value)});for(var d,e=0;e<this.supportedLanguages.length;e++){if(d=this.supportedLanguages[e],!this.chat[d])throw new Error(`${d} specified as supported language but can not be founded in chat object`);var h=document.createElement("option");h.textContent=getLanguageNativeName(d),h.value=d,g.appendChild(h)}c.appendChild(g)}b.appendChild(c)}b.appendChild(this.restartButton),this.startConversation()}changeChatLanguage(a){this.currentLanguage=a,this.handleRestart()}}
